# Feature Specification: 訂餐功能系統

**Feature Branch**: `002-order-food`  
**Created**: 2025年11月23日  
**Status**: Draft  
**Input**: User description: "Implement food ordering system with restaurant selection, menu browsing, cart management, checkout, and order history"

## Clarifications

### Session 2025-11-23

- Q: 訂單資料的持久化儲存機制為何？ → A: JSON 檔案儲存（類似現有的 stores.json）
- Q: 購物車（訂單摘要）在頁面間的狀態管理方式為何？ → A: Session 暫存（瀏覽器 Session Storage，關閉分頁即清空）
- Q: 訂單狀態的變更機制為何？ → A: 訂單建立後保持 Pending 狀態（此版本不實作狀態變更）
- Q: 超過 5 天的訂單自動清理觸發機制為何？ → A: 應用程式啟動時執行清理
- Q: 結帳頁面停留超過 30 分鐘的逾時處理行為為何？ → A: 僅顯示提示訊息（不強制動作）

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 訂購餐點流程 (Priority: P1)

使用者可以從首頁進入訂餐系統，瀏覽餐廳列表，選擇餐廳後查看菜單，將菜品加入訂單，完成結帳並取得訂單編號。

**Why this priority**: 這是整個訂餐功能的核心流程，涵蓋從選擇餐廳到完成訂單的完整使用者體驗。沒有此功能，訂餐系統無法運作。

**Independent Test**: 可透過完整的使用者操作路徑測試：點擊首頁「訂購餐點」按鈕 → 選擇餐廳 → 瀏覽菜單並加入訂單 → 填寫個人資訊 → 確認訂單 → 取得訂單編號。此流程可獨立測試並展示完整的訂餐功能價值。

**Acceptance Scenarios**:

1. **Given** 使用者在首頁, **When** 點擊「訂購餐點」按鈕, **Then** 跳轉至餐廳列表頁面
2. **Given** 系統中有餐廳資料, **When** 使用者進入餐廳列表頁面, **Then** 顯示所有可訂餐的餐廳卡片（包含名稱、地址、電話、營業時間）
3. **Given** 使用者在餐廳列表頁面, **When** 點擊「選擇此餐廳」按鈕, **Then** 跳轉至該餐廳的菜單頁面
4. **Given** 使用者在菜單頁面, **When** 查看菜單, **Then** 顯示該餐廳所有菜品的名稱和價格
5. **Given** 使用者選擇菜品數量（預設為1）, **When** 點擊「加入訂單」, **Then** 菜品加入訂單摘要區塊，顯示菜品名稱、數量、小計和訂單總金額
6. **Given** 使用者重複加入相同菜品, **When** 該菜品已在訂單中, **Then** 累加數量而非新增重複項目
7. **Given** 訂單摘要有菜品, **When** 使用者點擊「前往結帳」, **Then** 跳轉至結帳頁面
8. **Given** 使用者在結帳頁面, **When** 查看訂單, **Then** 顯示完整的訂單明細表格（菜品名稱、單價、數量、小計、總金額）
9. **Given** 使用者正確填寫姓名和電話, **When** 點擊「確認訂單」, **Then** 產生唯一訂單編號，顯示訂單提交成功頁面
10. **Given** 訂單成功提交, **When** 系統處理訂單, **Then** 訂單資料儲存至系統，使用者可透過訂單編號查詢

---

### User Story 2 - 訂單摘要即時更新 (Priority: P1)

使用者在瀏覽菜單時，可以在固定區塊查看當前訂單摘要，包含已選菜品清單、數量、小計和訂單總金額，並即時更新。

**Why this priority**: 訂單摘要讓使用者隨時掌握當前訂購內容和總金額，避免結帳時發現錯誤需要重新操作，提升使用者體驗和信任感。

**Independent Test**: 在菜單頁面加入多個菜品，驗證訂單摘要區塊即時顯示所有已選菜品、數量和總金額，並可獨立測試金額計算的正確性。

**Acceptance Scenarios**:

1. **Given** 使用者在菜單頁面, **When** 尚未加入任何菜品, **Then** 訂單摘要顯示為空，「前往結帳」按鈕為不可用狀態
2. **Given** 使用者加入第一個菜品, **When** 點擊「加入訂單」, **Then** 訂單摘要顯示該菜品的名稱、數量、小計，並更新訂單總金額
3. **Given** 使用者修改菜品數量, **When** 點擊 `+` 或 `-` 按鈕, **Then** 數量即時更新，訂單摘要中的小計和總金額自動重新計算
4. **Given** 使用者加入多個不同菜品, **When** 訂單摘要有多個項目, **Then** 每個項目獨立顯示，總金額為所有小計的加總（格式：NT$ 1,234.00）
5. **Given** 訂單摘要有菜品, **When** 使用者查看, **Then** 「前往結帳」按鈕變為可用狀態

---

### User Story 3 - 數量選擇與驗證 (Priority: P1)

使用者可以透過 `+`/`-` 按鈕或直接輸入數字來調整菜品數量，系統會驗證數量必須為正整數（最小值為1）。

**Why this priority**: 正確的數量驗證可避免訂單錯誤（如數量為0或負數），確保訂單資料的完整性和正確性。

**Independent Test**: 測試各種數量輸入情境（點擊按鈕、直接輸入數字、輸入無效值），驗證系統是否正確處理並顯示錯誤訊息。

**Acceptance Scenarios**:

1. **Given** 使用者在菜品數量輸入框, **When** 點擊 `+` 按鈕, **Then** 數量增加1
2. **Given** 數量大於1, **When** 點擊 `-` 按鈕, **Then** 數量減少1
3. **Given** 數量為1, **When** 點擊 `-` 按鈕, **Then** 數量維持為1（不可小於1）
4. **Given** 使用者直接在輸入框輸入數字, **When** 輸入0或負數, **Then** 自動修正為1
5. **Given** 使用者直接在輸入框輸入數字, **When** 輸入非整數（小數或文字）, **Then** 顯示驗證錯誤訊息「數量必須為正整數」
6. **Given** 使用者選擇數量後, **When** 點擊「加入訂單」, **Then** 系統接受正整數並加入訂單摘要

---

### User Story 4 - 訂單資訊驗證與提交 (Priority: P1)

使用者在結帳頁面必須填寫姓名和聯絡電話，系統驗證欄位必填且電話僅能為數字，驗證通過後產生訂單編號並儲存訂單。

**Why this priority**: 訂單資訊驗證確保系統取得有效的聯絡資訊，避免無效訂單產生，同時確保訂單資料完整性。

**Independent Test**: 測試各種填寫情境（空白欄位、無效電話格式、正確資訊），驗證系統是否正確驗證並提交訂單。

**Acceptance Scenarios**:

1. **Given** 使用者在結帳頁面, **When** 姓名欄位空白且點擊「確認訂單」, **Then** 顯示「姓名為必填欄位」錯誤訊息
2. **Given** 使用者在結帳頁面, **When** 電話欄位空白且點擊「確認訂單」, **Then** 顯示「聯絡電話為必填欄位」錯誤訊息
3. **Given** 使用者填寫電話, **When** 電話包含非數字字元（如英文字母、符號）, **Then** 顯示「電話號碼僅能輸入數字」錯誤訊息
4. **Given** 使用者正確填寫所有資訊, **When** 點擊「確認訂單」, **Then** 產生唯一訂單編號（格式：ORD{yyyyMMddHHmmssfff}），訂單資料儲存至系統
5. **Given** 訂單成功提交, **When** 系統處理完成, **Then** 顯示訂單提交成功頁面，包含訂單編號、「返回首頁」和「查看訂單紀錄」連結

---

### User Story 5 - 查看訂單歷史紀錄 (Priority: P2)

使用者可以從首頁或訂單成功頁面進入訂單紀錄頁面，查看最近5天內的訂單清單（包含訂單編號、日期、餐廳名稱、總金額、狀態），並可查看個別訂單的詳細資訊。

**Why this priority**: 訂單歷史紀錄讓使用者追蹤過往訂單，方便重新訂購或查詢訂單狀態，提升使用者對系統的信任感和便利性。

**Independent Test**: 建立多筆測試訂單後，進入訂單紀錄頁面，驗證是否正確顯示最近5天的訂單清單，並可點擊查看個別訂單詳情。

**Acceptance Scenarios**:

1. **Given** 系統中有訂單紀錄, **When** 使用者進入訂單紀錄頁面, **Then** 顯示最近5天內的訂單清單（最新的在最上方）
2. **Given** 訂單清單顯示, **When** 使用者查看每筆訂單, **Then** 顯示訂單編號、訂購日期時間、餐廳名稱、訂單總金額、訂單狀態
3. **Given** 使用者在訂單清單, **When** 點擊「查看詳情」按鈕, **Then** 顯示該訂單的完整資訊（訂單明細、訂餐者資訊、訂單狀態）
4. **Given** 系統中無訂單紀錄, **When** 使用者進入訂單紀錄頁面, **Then** 顯示「目前沒有訂單紀錄」訊息
5. **Given** 訂單超過5天, **When** 系統執行自動清理, **Then** 舊訂單從系統中移除，訂單紀錄頁面不再顯示

---

### User Story 6 - 進行中訂單提示 (Priority: P2)

當使用者有進行中的訂單（狀態為待確認 Pending）時，在餐廳列表頁面頂部顯示提醒區塊，包含訂單編號、餐廳名稱、訂單狀態和「查看訂單詳情」按鈕。

**Why this priority**: 進行中訂單提示讓使用者快速了解當前訂單狀態，避免重複訂購或遺忘訂單，提升使用者體驗。

**Independent Test**: 建立一筆進行中的訂單，進入餐廳列表頁面，驗證是否正確顯示訂單提示區塊並可點擊查看詳情。

**Acceptance Scenarios**:

1. **Given** 使用者當前有進行中的訂單, **When** 進入餐廳列表頁面, **Then** 頁面頂部顯示「您有進行中的訂單」提醒區塊
2. **Given** 提醒區塊顯示, **When** 使用者查看, **Then** 顯示訂單編號、餐廳名稱、訂單狀態（待確認 Pending）
3. **Given** 提醒區塊顯示, **When** 使用者點擊「查看訂單詳情」按鈕, **Then** 跳轉至該訂單的詳情頁面
4. **Given** 提醒區塊顯示, **When** 使用者查看提示文字, **Then** 顯示「已有訂單進行中，是否繼續點餐？」
5. **Given** 使用者沒有進行中的訂單, **When** 進入餐廳列表頁面, **Then** 不顯示提醒區塊

---

### User Story 7 - 返回修改訂單 (Priority: P3)

使用者在結帳頁面可以點擊「返回修改」按鈕，回到菜單頁面修改訂單內容，系統會保留當前已選擇的菜品。

**Why this priority**: 允許使用者在結帳前修改訂單，提升使用者體驗和彈性，避免因錯誤需要重新操作整個流程。

**Independent Test**: 在結帳頁面點擊「返回修改」按鈕，驗證是否返回菜單頁面並保留訂單內容。

**Acceptance Scenarios**:

1. **Given** 使用者在結帳頁面, **When** 點擊「返回修改」按鈕, **Then** 返回菜單頁面
2. **Given** 使用者返回菜單頁面, **When** 查看訂單摘要, **Then** 保留之前已選擇的菜品、數量和總金額
3. **Given** 使用者返回菜單頁面, **When** 修改訂單內容（增加、刪除或調整數量）, **Then** 訂單摘要即時更新
4. **Given** 使用者完成修改, **When** 再次點擊「前往結帳」, **Then** 顯示更新後的訂單明細

---

### Edge Cases

- 當系統中沒有餐廳資料時，餐廳列表頁面顯示「目前沒有可訂餐的餐廳」訊息
- 當餐廳的菜單為空時，菜單頁面顯示「此餐廳目前沒有可訂購的菜品」訊息
- 當使用者在結帳頁面停留過久（超過30分鐘），系統顯示提示訊息「訂單已逾時，請重新選擇菜品」，但仍允許使用者繼續結帳（不強制清空購物車或導向其他頁面）
- 當使用者在不同裝置同時操作訂單時，系統以最後提交的訂單為準
- 當訂單資料檔案損壞或無法讀取時，系統顯示錯誤訊息並記錄日誌
- 當使用者輸入的電話號碼過長（超過20位數）時，顯示「電話號碼長度不可超過20位數」錯誤訊息
- 當訂單總金額超過系統限制（如100,000元）時，系統提示「訂單金額過高，請聯絡客服」
- 當使用者嘗試加入超過100個相同菜品時，系統限制單一菜品最大數量為100，並顯示提示訊息
- 當餐廳在使用者選擇後被刪除時，系統允許完成訂單（因訂單中儲存餐廳名稱快照），但新訂單不可選擇該餐廳

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須提供首頁「訂購餐點」按鈕，使用者點擊後跳轉至餐廳列表頁面
- **FR-002**: 系統必須從資料來源讀取餐廳資訊，並在餐廳列表頁面顯示所有可訂餐的餐廳（包含名稱、地址、電話、營業時間）
- **FR-003**: 系統必須提供餐廳選擇功能，使用者點擊餐廳後跳轉至該餐廳的菜單頁面
- **FR-004**: 系統必須在菜單頁面顯示該餐廳的所有菜品（包含名稱和價格）
- **FR-005**: 系統必須提供數量選擇器（+/- 按鈕和數字輸入框），允許使用者調整菜品數量
- **FR-006**: 系統必須驗證菜品數量為正整數（最小值為1），對於無效輸入（0、負數、小數、文字）顯示錯誤訊息或自動修正
- **FR-007**: 系統必須提供「加入訂單」功能，將選定的菜品和數量加入訂單摘要，並儲存至 Session Storage
- **FR-008**: 系統必須在訂單摘要區塊即時顯示已選菜品清單、數量、小計和訂單總金額（格式：NT$ 1,234.00），從 Session Storage 讀取購物車狀態
- **FR-009**: 系統必須在加入相同菜品時累加數量，而非新增重複項目
- **FR-010**: 系統必須在訂單摘要為空時將「前往結帳」按鈕設為不可用狀態
- **FR-011**: 系統必須提供結帳頁面，顯示完整的訂單明細表格（菜品名稱、單價、數量、小計、訂單總金額）
- **FR-012**: 系統必須在結帳頁面提供訂餐者資訊輸入表單（姓名、聯絡電話）
- **FR-013**: 系統必須驗證姓名和電話為必填欄位，空白時顯示錯誤訊息
- **FR-014**: 系統必須驗證電話號碼僅能包含數字，對於非數字字元顯示錯誤訊息
- **FR-015**: 系統必須在使用者確認訂單後產生唯一訂單編號（格式：ORD{yyyyMMddHHmmssfff}）
- **FR-016**: 系統必須將訂單資料持久化儲存至 JSON 檔案（如 `Data/orders.json`），包含訂單編號、餐廳資訊、訂餐者資訊、訂單項目、總金額、訂單狀態和建立時間
- **FR-017**: 系統必須在訂單成功提交後顯示訂單編號、「返回首頁」和「查看訂單紀錄」連結
- **FR-018**: 系統必須提供訂單紀錄頁面，顯示最近5天內的訂單清單（包含訂單編號、日期、餐廳名稱、總金額、狀態）
- **FR-019**: 系統必須在應用程式啟動時自動清理超過5天的訂單資料（從 JSON 檔案中移除）
- **FR-020**: 系統必須提供訂單詳情頁面，顯示個別訂單的完整資訊（訂單明細、訂餐者資訊、訂單狀態）
- **FR-021**: 系統必須在餐廳列表頁面頂部顯示進行中訂單提示（當使用者有進行中的訂單時）
- **FR-022**: 系統必須在進行中訂單提示區塊顯示訂單編號、餐廳名稱、訂單狀態和「查看訂單詳情」按鈕
- **FR-023**: 系統必須提供「返回修改」功能，允許使用者從結帳頁面返回菜單頁面，並從 Session Storage 保留當前已選擇的菜品
- **FR-024**: 系統必須在菜品價格變動時使用快照資料（訂單中儲存的價格），避免影響歷史訂單
- **FR-025**: 系統必須在餐廳刪除時使用快照資料（訂單中儲存的餐廳名稱），確保歷史訂單可正常顯示
- **FR-026**: 系統必須計算訂單總金額為所有訂單項目小計的加總（小計 = 單價 × 數量）
- **FR-027**: 系統必須在沒有餐廳資料時顯示「目前沒有可訂餐的餐廳」訊息
- **FR-028**: 系統必須在沒有訂單紀錄時顯示「目前沒有訂單紀錄」訊息
- **FR-029**: 系統必須在建立新訂單時將訂單狀態設為 Pending（待確認），此版本不實作訂單狀態變更功能
- **FR-030**: 系統必須在結帳頁面停留超過 30 分鐘時顯示逾時提示訊息，但不強制清空購物車或阻止使用者繼續結帳

### Key Entities

- **Order（訂單）**: 代表一筆完整的訂單，包含唯一訂單編號、餐廳資訊（ID和名稱快照）、訂餐者資訊（姓名和電話）、訂單項目清單、訂單總金額、訂單狀態（預設為 Pending）和建立時間
- **OrderItem（訂單項目）**: 代表訂單中的單一菜品項目，包含菜品ID、菜品名稱快照、單價快照、訂購數量和小計（單價 × 數量）
- **OrderStatus（訂單狀態）**: 定義訂單的狀態，此版本所有訂單建立後預設為待確認（Pending）狀態，未來版本可擴充其他狀態（如已確認、準備中、已完成、已取消）
- **Store（餐廳）**: 代表可訂餐的餐廳，包含餐廳ID（StoreId）、名稱、地址、聯絡電話、營業時間和菜單項目清單（關聯至MenuItems）
- **MenuItem（菜品）**: 代表餐廳的菜品，包含菜品ID、名稱和價格

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 使用者可在5分鐘內完成從選擇餐廳到確認訂單的完整流程（包含瀏覽菜單、加入訂單、填寫資訊和提交訂單）
- **SC-002**: 訂單總金額計算準確率達100%（所有訂單的總金額必須等於各項目小計的加總）
- **SC-003**: 使用者在第一次使用時，90%可成功完成訂單提交而不需要客服協助
- **SC-004**: 訂單資訊驗證錯誤訊息能在1秒內顯示，使用者可即時了解錯誤原因並修正
- **SC-005**: 訂單摘要區塊的更新延遲不超過500毫秒，使用者操作後可即時看到變化
- **SC-006**: 訂單紀錄查詢速度不超過2秒（對於最近5天內的訂單清單）
- **SC-007**: 系統可正確處理至少100筆訂單資料而不影響效能
- **SC-008**: 使用者滿意度調查中，85%的使用者認為訂餐流程「簡單易用」
- **SC-009**: 訂單提交成功率達95%以上（排除使用者主動取消或中斷的情況）
- **SC-010**: 自動清理舊訂單功能執行成功率達100%，確保訂單資料僅保留最近5天
